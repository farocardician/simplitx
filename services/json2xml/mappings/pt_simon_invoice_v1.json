{
  "root": {
    "tag": "TaxInvoiceBulk",
    "nsmap": {
      "xsd": "http://www.w3.org/2001/XMLSchema",
      "xsi": "http://www.w3.org/2001/XMLSchema-instance"
    }
  },
  "structure": {
    "TIN": "0715420659018000",
    "ListOfTaxInvoice": {
      "TaxInvoice": {
        "TaxInvoiceDate": "$.data.invoice.date",
        "TaxInvoiceOpt": "Normal",
        "TrxCode": "04",
        "AddInfo": "",
        "CustomDoc": "",
        "CustomDocMonthYear": "",
        "RefDesc": "$.data.invoice.number", 
        "FacilityStamp": "",
        "SellerIDTKU": "0715420659018000000000",
        "BuyerTin": "0849873807086000",
        "BuyerDocument": "TIN",
        "BuyerCountry": "IDN", 
        "BuyerDocumentNumber": "-",
        "BuyerName": "$.data.buyer.name",
        "BuyerAdress": "KOMPLEK GREEN VILLE  Blok AV No.15B RT:008 RW:014 ",
        "BuyerEmail": "",
        "BuyerIDTKU": "0849873807086000000000",
        "ListOfGoodService": {
          "_array": "$.data.items[*]",
          "GoodService": {
            "Opt": "A",
            "Code": {"path": "$.hs_code", "compute": "hs_code_to_full"},
            "Name": "$.description",
            "Unit": "UM.0018",
            "Price": {"path": "$.unit_price", "format": {"type": "decimal", "scale": 2}},
            "Qty": "$.qty",
            "TotalDiscount": "0",
            "TaxBase": {"path": "$.amount", "format": {"type": "decimal", "scale": 2}},
            "OtherTaxBase": {"path": "$.amount", "compute": "other_tax_base"},
            "VATRate": "12",
            "VAT": {"path": "$.amount", "compute": "vat_amount"},
            "STLGRate": "0",
            "STLG": "0"
          }
        }
      }
    }
  },
  "computations": {
    "hs_code_to_full": {
      "expression": "str(code) + suffix",
      "inputs": {
        "code": {"source": "field"}
      },
      "parameters": {
        "suffix": "00"
      }
    },
    "other_tax_base": {
      "expression": "(amount / divisor) * multiplier",
      "inputs": {
        "amount": {"source": "field"}
      },
      "parameters": {
        "divisor": 12,
        "multiplier": 11
      },
      "format": {"type": "decimal", "scale": 2}
    },
    "vat_amount": {
      "expression": "amount * rate",
      "inputs": {
        "amount": {"source": "field"}
      },
      "parameters": {
        "rate": 0.11
      },
      "format": {"type": "decimal", "scale": 2}
    }
  }
}
