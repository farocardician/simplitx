{
  "profile": {
    "name": "pt_simon_hybrid",
    "fail_mode": "soft",
    "required_fields": ["invoice_no", "invoice_date", "customer_id"],
    "expected_fields": ["seller", "currency"],
    "optional_fields": ["po_reference", "customer_name", "uom", "subtotal", "tax_base", "tax_amount", "grand_total"]
  },
  "use_stage2_normalized": true,
  "guards": {
    "invoice_no": { "allowed_chars": "A-Za-z0-9-/", "min_len": 5, "max_len": 40 },
    "invoice_date": { "min_len": 8, "max_len": 20 },
    "customer_id": { "allowed_chars": "A-Za-z0-9-", "min_len": 2, "max_len": 40 }
  },
  "confidence": {
    "thresholds": {
      "high": { "max_lines": 1, "max_tokens": 15 },
      "medium": { "max_lines": 3, "max_tokens": 60 }
    }
  },
  "totals": { "mode": "segments_only" },
  "fields": {
    "invoice_no": {
      "segment": "invoice_no",
      "strategy": "regex_capture",
      "post": {
        "capture_regex": "([A-Z0-9-]+-\\d{6}-\\d{4})"
      }
    },
    "invoice_date": {
      "segment": "invoice_date",
      "strategy": "regex_capture",
      "post": {
        "capture_regex": "(\\d{4}-\\d{2}-\\d{2})"
      }
    },
    "customer_id": {
      "segment": "customer_id",
      "strategy": "regex_capture",
      "post": {
        "regex_pattern": [
          "(?:cust\\.?\\s*code\\s*:?)\\s*([A-Za-z0-9\\-_/\\.]+)",
          "(?:customer\\s*id\\s*:?)\\s*([A-Za-z0-9\\-_/\\.]+)",
          "([A-Za-z0-9][A-Za-z0-9\\-_/\\.]{2,})"
        ]
      }
    },
    "seller": {
      "segment": "seller",
      "strategy": "regex_capture",
      "post": {
        "capture_regex": "(PT\\s+.*?Indonesia)"
      }
    },
    "subtotal": {
      "segment": "total",
      "strategy": "regex_capture",
      "post": {
        "capture_regex": "(?:^\\s*\\d[\\d,]*\\s+|(?:sub\\s*total|subtotal)[^\\d]*?)([\\(\\-]?\\d{1,3}(?:[.,]\\d{3})*(?:[.,]\\d+)?[\\)]?)"
      }
    },
    "tax_base": {
      "segment": "total",
      "strategy": "regex_capture",
      "post": {
        "capture_regex": "(?:(?:total\\s*tax\\s*based|tax\\s*base|dpp|dasar\\s*pajak)[^\\n]*?:\\s*)([\\(\\-]?\\d{1,3}(?:[.,]\\d{3})*(?:[.,]\\d+)?[\\)]?)"
      }
    },
    "tax_amount": {
      "segment": "total",
      "strategy": "regex_capture",
      "post": {
        "capture_regex": "(?:(?:vat|ppn)\\s*\\d{1,2}\\s*%[^\\n]*?:\\s*)([\\(\\-]?\\d{1,3}(?:[.,]\\d{3})*(?:[.,]\\d+)?[\\)]?)"
      }
    },
    "grand_total": {
      "segment": "total",
      "strategy": "regex_capture",
      "post": {
        "capture_regex": "(?:(?:grand\\s*total|total\\s*(?:incl|including).*?vat)[^\\n]*?:\\s*)([\\(\\-]?\\d{1,3}(?:[.,]\\d{3})*(?:[.,]\\d+)?[\\)]?)"
      }
    },
    "total_qty": {
      "segment": "total",
      "strategy": "regex_capture",
      "post": {
        "capture_regex": "^\\s*([0-9][0-9,]*)"
      }
    },
    "vat_rate": {
      "segment": "total",
      "strategy": "regex_capture",
      "post": {
        "capture_regex": "(?:vat|ppn)\\s*([0-9]{1,2}\\s*%)"
      }
    }
  }
}
