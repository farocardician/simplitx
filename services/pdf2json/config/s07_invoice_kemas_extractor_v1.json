{
  "name": "Kemas Invoice Extractor Config V1",
  "version": "1.0",
  "strict_segments": true,
  "use_stage2_normalized": true,
  "profile": {
    "name": "kemas_invoice_v1",
    "fail_mode": "hard",
    "required_fields": ["buyer_name", "invoice_number", "invoice_date", "subtotal", "tax_amount", "grand_total"],
    "expected_fields": ["buyer_name", "invoice_number", "invoice_date", "subtotal", "tax_base", "tax", "tax_amount", "income_tax", "income_tax_amount", "grand_total"],
    "optional_fields": ["tax_base", "tax", "income_tax", "income_tax_amount"]
  },
  "confidence": {
    "thresholds": {
      "high": { "max_lines": 1, "max_tokens": 15 },
      "medium": { "max_lines": 3, "max_tokens": 60 }
    }
  },
  "fields": {
    "buyer_name": {
      "strategy": "strict_full_text",
      "segment": "buyer_name"
    },
    "invoice_number": {
      "strategy": "regex_capture",
      "segment": "invoice_number",
      "post": {
        "regex_pattern": ["Number\\s+([A-Z0-9/\\-]+)"]
      }
    },
    "invoice_date": {
      "strategy": "regex_capture",
      "segment": "invoice_date",
      "post": {
        "regex_pattern": ["Date\\s+([0-9]{2}\\-[A-Za-z]{3}\\-[0-9]{2})"]
      }
    },
    "subtotal": {
      "strategy": "regex_capture",
      "segment": "subtotal",
      "post": {
        "regex_pattern": ["TOTAL\\s+([0-9]{1,3}(\\.[0-9]{3})*)"]
      }
    },
    "tax_base": {
      "strategy": "constant",
      "post": {
        "value": ""
      }
    },
    "tax": {
      "strategy": "constant",
      "post": {
        "value": ""
      }
    },
    "tax_amount": {
      "strategy": "regex_capture",
      "segment": "total",
      "post": {
        "regex_pattern": ["([0-9]{1,3}(\\.[0-9]{3})*)\\s+PPn"]
      }
    },
    "income_tax": {
      "strategy": "constant",
      "post": {
        "value": ""
      }
    },
    "income_tax_amount": {
      "strategy": "constant",
      "post": {
        "value": ""
      }
    },
    "grand_total": {
      "strategy": "regex_capture",
      "segment": "grand_total",
      "post": {
        "regex_pattern": ["([0-9]{1,3}(\\.[0-9]{3})*)\\s+GRAND\\s+TOTAL"]
      }
    }
  },
  "guards": {
    "buyer_name": {
      "min_len": 3,
      "max_len": 100,
      "allowed_chars": "A-Za-z0-9\\.\\-&\\s"
    },
    "invoice_number": {
      "min_len": 5,
      "max_len": 50,
      "allowed_chars": "A-Z0-9/\\-"
    },
    "invoice_date": {
      "min_len": 8,
      "max_len": 15,
      "allowed_chars": "0-9\\-A-Za-z"
    },
    "subtotal": {
      "min_len": 3,
      "max_len": 25,
      "allowed_chars": "0-9."
    },
    "tax_amount": {
      "min_len": 3,
      "max_len": 25,
      "allowed_chars": "0-9."
    },
    "grand_total": {
      "min_len": 3,
      "max_len": 25,
      "allowed_chars": "0-9."
    }
  },
  "totals": {
    "mode": "segments_only"
  }
}