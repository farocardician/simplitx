{
  "name": "Rittal Invoice Segmenter Config V1",
  "version": "3.0",
  "coords": { "normalized": true, "y_origin": "top", "precision": 6 },
  "defaults": { "min_height": 0.02 },
  "regions": [
    {
      "id": "header",
      "on_pages": "first",
      "keep": "first",
      "only_if_contains": ["INVOICE", "RITTAL"],
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^INVOICE$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "topmost"
        },
        "capture_window": {
          "mode": "around",
          "dx": 0.60,
          "dy": 0.16
        },
        "margin": { "top": 0.010, "right": 0.015, "bottom": 0.010, "left": 0.020 }
      },
      "fallbacks": [
        { "by": "y_cutoff", "edge": "top", "y": 0.305 },
        { "by": "fixed_box", "bbox": [0.03, 0.04, 0.90, 0.31] }
      ]
    },
    {
      "id": "seller",
      "inside": "@header",
      "on_pages": "first",
      "keep": "first",
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^PT\\.?\\s*RITTAL$", "^PT\\.$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "topmost"
        },
        "capture_window": {
          "mode": "below_rows",
          "rows": 5,
          "pad_left": 0.05,
          "pad_right": 0.26
        }
      },
      "fallbacks": [
        { "by": "fixed_box", "bbox": [0.33, 0.045, 0.66, 0.128] }
      ]
    },
    {
      "id": "buyer",
      "inside": "@header",
      "on_pages": "first",
      "keep": "first",
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^To$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "leftmost"
        },
        "capture_window": {
          "mode": "below_rows",
          "rows": 6,
          "pad_left": 0.02,
          "pad_right": 0.36
        }
      },
      "fallbacks": [
        { "by": "fixed_box", "bbox": [0.05, 0.17, 0.40, 0.235] }
      ]
    },
    {
      "id": "invoice_date",
      "inside": "@header",
      "on_pages": "first",
      "keep": "first",
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^Date$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "topmost"
        },
        "capture_window": {
          "mode": "below_rows",
          "rows": 1,
          "pad_left": 0.02,
          "pad_right": 0.14
        }
      },
      "fallbacks": [
        { "by": "fixed_box", "bbox": [0.45, 0.168, 0.63, 0.300] }
      ]
    },
    {
      "id": "invoice_no",
      "inside": "@header",
      "on_pages": "first",
      "keep": "first",
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^Number$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "topmost"
        },
        "capture_window": {
          "mode": "below_rows",
          "rows": 1,
          "pad_left": 0.04,
          "pad_right": 0.09
        }
      },
      "fallbacks": [
        { "by": "fixed_box", "bbox": [0.70, 0.168, 0.84, 0.300] }
      ]
    },
    {
      "id": "currency",
      "inside": "@header",
      "on_pages": "first",
      "keep": "first",
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^Currency$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "topmost"
        },
        "capture_window": {
          "mode": "below_rows",
          "rows": 1,
          "pad_left": 0.04,
          "pad_right": 0.09
        }
      },
      "fallbacks": [
        { "by": "fixed_box", "bbox": [0.70, 0.168, 0.84, 0.300] }
      ]
    },
    {
      "id": "total",
      "on_pages": "last",
      "keep": "first",
      "only_if_contains": ["Sub", "VAT", "Total"],
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^Sub$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "topmost"
        },
        "capture_window": {
          "mode": "right_then_rows",
          "start_edge": "left",
          "gap_x": 0.001,
          "dx_max": 0.6,
          "rows": 4,
          "row_tol": 0.010
        },        
        "margin": { "top": 0.010, "right": 0.010, "bottom": 0.010, "left": 0.010 }
      }
    },
    {
      "id": "subtotal",
      "inside": "@total",
      "on_pages": "last",
      "keep": "first",
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^Sub$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "topmost"
        },
        "capture_window": {
          "mode": "right_then_rows",
          "start_edge": "left",
          "gap_x": 0.01,
          "dx_max": 0.55,
          "rows": 0,
          "row_tol": 0.010
        }       
      }
    },
    {
      "id": "tax_based",
      "inside": "@total",
      "on_pages": "last",
      "keep": "first",
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^Tax$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "topmost"
        },
        "capture_window": {
          "mode": "right_then_rows",
          "start_edge": "left",
          "gap_x": 0.01,
          "dx_max": 0.55,
          "rows": 0,
          "row_tol": 0.010
        }       
      }
    },
    {
      "id": "vat",
      "inside": "@total",
      "on_pages": "last",
      "keep": "first",
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^VAT$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "topmost"
        },
        "capture_window": {
          "mode": "right_then_rows",
          "start_edge": "left",
          "gap_x": 0.01,
          "dx_max": 0.55,
          "rows": 0,
          "row_tol": 0.010
        }       
      }
    },
    {
      "id": "grand_total",
      "inside": "@total",
      "on_pages": "last",
      "keep": "first",
      "detect": {
        "by": "anchors",
        "start_anchor": {
          "patterns": ["^Total$"],
          "flags": { "ignore_case": true, "normalize_space": true },
          "select": "bottommost"
        },
        "capture_window": {
          "mode": "right_then_rows",
          "start_edge": "left",
          "gap_x": 0.01,
          "dx_max": 0.55,
          "rows": 1,
          "row_tol": 0.010
        }       
      }
    }
  ]
}
